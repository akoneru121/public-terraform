# public - EKS Terraform Configuration

This Terraform configuration was generated by **EKS Wizard** and includes everything needed to deploy a production-ready Amazon EKS cluster.

## ğŸ“‹ Configuration Summary

- **Project Name**: public
- **AWS Region**: us-east-1
- **Kubernetes Version**: 1.31
- **VPC CIDR**: 10.0.0.0/16
- **Node Group**: 2-3 nodes (desired: 2)
- **Instance Types**: t3.medium, t3.large
- **Capacity Type**: ON_DEMAND

- **ALB Ingress**: Public


## ğŸ—ï¸ Infrastructure Components

### Network (vpc.tf)
- VPC with DNS support enabled
- 3 public subnets across availability zones
- 3 private subnets across availability zones
- Internet Gateway for public subnets

- No NAT Gateway (private subnets have no internet access)

- Route tables and associations

### EKS Cluster (eks.tf)
- EKS cluster with control plane logging enabled
- IRSA (IAM Roles for Service Accounts) configured
- OIDC provider for workload identity
- Security groups for cluster control plane

- IAM role and policy for AWS Load Balancer Controller


### Node Groups (node_groups.tf)
- Managed node group with auto-scaling
- Launch template with encrypted EBS volumes
- IMDSv2 enforced for enhanced security
- Security groups for worker nodes

### Add-ons




## ğŸ’° Cost Breakdown

### Estimated Monthly Costs
- **EKS Control Plane**: $73

- **NAT Gateway**: $0 (disabled)

- **Worker Nodes** (2 x t3.medium, t3.large): Varies by instance type
- **Load Balancer** (if enabled): ~$16/month
- **Data Transfer**: ~$0.02/GB out


**Total Estimate**: $100-$350/month (no NAT, private subnets isolated)


### NAT Gateway Cost vs Availability Trade-offs

| Configuration | Cost | Availability | Use Case |
|--------------|------|--------------|----------|

| Single NAT | ~$32/mo | Medium | Dev/Test, cost-sensitive workloads |


| **Multi-AZ NAT (Selected)** | ~$96/mo | High | Production, HA requirements |


| **No NAT (Selected)** | $0 | N/A | Air-gapped, VPC endpoints only |




**Warning**: Without NAT Gateway, private subnets cannot access the internet. Nodes cannot:
- Pull container images from public registries (use VPC endpoints for ECR)
- Access AWS services without VPC endpoints
- Download software updates


### Cost Optimization Tips
âœ… Use SPOT instances instead of ON_DEMAND (up to 70% savings)
âœ… Scale down during off-hours
âœ… Enable Cluster Autoscaler to right-size nodes
âœ… Use Fargate for bursty workloads

âœ… Consider Single NAT for non-production environments


---

## ğŸ”’ Security Checklist

### Network Security
- [ ] VPC uses private subnets for nodes
- [ ] Public subnets have NAT gateways
- [ ] Security groups restrict ingress
- [ ] Network ACLs configured
- [ ] VPC Flow Logs enabled

### IAM & Access Control
- [ ] IRSA (IAM Roles for Service Accounts) configured
- [ ] Service accounts use least privilege roles
- [ ] Node IAM role only has required permissions
- [ ] MFA enabled for AWS accounts with Terraform access
- [ ] Regular access reviews scheduled

### Cluster Security
- [ ] Control plane encryption enabled
- [ ] Audit logging enabled
- [ ] Pod Security Standards enforced
- [ ] Network policies configured
- [ ] ImagePullSecrets for private registries

### Compliance & Monitoring
- [ ] CloudTrail enabled for audit trail
- [ ] CloudWatch alarms configured
- [ ] Prometheus monitoring active
- [ ] Log aggregation enabled (CloudWatch Logs)
- [ ] Regular security assessments scheduled

---

## ğŸš€ Deployment Steps

### Prerequisites

1. **AWS CLI** installed and configured
   ```bash
   aws configure
   aws sts get-caller-identity  # Verify access
   ```

2. **Terraform** installed (version >= 1.0)
   ```bash
   terraform version
   ```

3. **kubectl** installed (optional, for cluster interaction)
   ```bash
   kubectl version --client
   ```

4. **AWS IAM Permissions** - Ensure your user has permissions for:
   - EKS, VPC, EC2, IAM, KMS, CloudWatch

### Deploy the Cluster

1. **Initialize Terraform**
   ```bash
   terraform init
   ```

2. **Review the Plan**
   ```bash
   terraform plan -out=tfplan
   ```

3. **Apply the Configuration**
   ```bash
   terraform apply
   ```
   Type `yes` when prompted to confirm.

   This will take approximately 10-15 minutes to complete.

4. **Configure kubectl**
   ```bash
   aws eks update-kubeconfig --region us-east-1 --name public-eks
   ```

5. **Verify the Cluster**
   ```bash
   kubectl get nodes
   kubectl get pods -A
   ```


## ğŸ”§ Installing AWS Load Balancer Controller

After the cluster is deployed, install the AWS Load Balancer Controller:

1. **Add the EKS Helm chart repository**
   ```bash
   helm repo add eks https://aws.github.io/eks-charts
   helm repo update
   ```

2. **Install the AWS Load Balancer Controller**
   ```bash
   kubectl apply -k "github.com/aws/eks-charts/stable/aws-load-balancer-controller/crds?ref=master"
   
   helm install aws-load-balancer-controller eks/aws-load-balancer-controller \
     -n kube-system \
     --set clusterName=public-eks \
     --set serviceAccount.create=true \
     --set serviceAccount.name=aws-load-balancer-controller \
     --set serviceAccount.annotations."eks\.amazonaws\.com/role-arn"=$(terraform output -raw aws_load_balancer_controller_role_arn)
   ```

3. **Verify the installation**
   ```bash
   kubectl get deployment -n kube-system aws-load-balancer-controller
   ```










## ğŸ“Š Outputs

After deployment, Terraform will output useful information:

```bash
terraform output
```

Key outputs include:
- `cluster_endpoint` - EKS API server endpoint
- `cluster_name` - EKS cluster name
- `configure_kubectl` - Command to configure kubectl
- `vpc_id` - VPC identifier
- `public_subnets` - Public subnet IDs
- `private_subnets` - Private subnet IDs

## ğŸ§¹ Cleanup

To destroy all resources:

```bash
terraform destroy
```

**Warning**: This will delete all resources including the VPC, EKS cluster, and node groups. Make sure to backup any important data first.

## ğŸ“ Customization

You can customize the deployment by editing `variables.tf` and changing the default values, or by creating a `terraform.tfvars` file:

```hcl
project_name = "my-custom-cluster"
kubernetes_version = "1.30"
node_group_desired_size = 5
```

## ğŸ” Security Best Practices

This configuration includes several security best practices:

- âœ… Encrypted EBS volumes
- âœ… IMDSv2 enforced on EC2 instances
- âœ… Private subnets for worker nodes
- âœ… Security groups with minimal required access
- âœ… Control plane logging enabled
- âœ… IRSA (IAM Roles for Service Accounts) configured

## ğŸ“š Additional Resources

- [EKS Best Practices](https://aws.github.io/aws-eks-best-practices/)
- [Terraform AWS Provider Documentation](https://registry.terraform.io/providers/hashicorp/aws/latest/docs)
- [EKS User Guide](https://docs.aws.amazon.com/eks/latest/userguide/)

---

Generated by **EKS Wizard** on now